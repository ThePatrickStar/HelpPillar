import os

COMBINED_FILE = 'malware_family_date.txt'
FAMILY_FILE = 'malware_family_processed.txt'
RAW_FAMILY_FILE = 'malware_family.txt'
MALWARE_FILE = 'malware_date.txt'

with open(RAW_FAMILY_FILE) as f:
    raw_tuples = f.readlines()

if not os.path.isfile('./'+FAMILY_FILE):
    print 'the processed malware family file doesn\'t exist!\n processing...'
    output_file = open(FAMILY_FILE, 'w+')
    for i in raw_tuples:
        data_array = i.split('\t')
        sha = data_array[0]
        family = data_array[1].split()[0]
        if family.startswith('SINGLETON'):
            family = 'unknown'
        line = sha + ' ' + family + '\n'
        output_file.write(line)
    output_file.close()
    print 'finished processing'

if not os.path.isfile('./'+COMBINED_FILE):
    print 'the combined malware family/date file doesn\'t exist!\n combining...'
    output_file = open(COMBINED_FILE, 'w+')

    family_dict = {}
    date_dict = {}

    with open(FAMILY_FILE) as f:
        family_tuples = f.readlines()

    with open(MALWARE_FILE) as f:
        malware_tuples = f.readlines()

    for i in family_tuples:
        data_array = i.split()
        family_dict[data_array[0]] = data_array[1]

    for i in malware_tuples:
        data_array = i.split()
        date_dict[data_array[0]] = data_array[1]

    for i in family_dict:
        if date_dict.get(i) is not None:
            line = i + ' ' + date_dict[i] + ' ' + family_dict[i] + '\n'
            output_file.write(line)

    output_file.close()
    print 'finished combining'


